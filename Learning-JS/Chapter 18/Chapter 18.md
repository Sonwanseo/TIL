# Chapter 18. 브라우저의 자바스크립트

### 18.1 ES5와 ES6

에버그린 브라우저는 자동으로, 사용자의 의사를 묻지도 않고 업데이트하는 방법으로 새 웹 표준을 더 빨리, 지속해서 적용한다.
ES6를 ES5로 바꾸는 것을 트랜스컴파일이라 한다.

### 18.2 문서 객체 모델

DOM, 즉 문서 객체 모델은 HTML 문서의 구조를 나타내는 표기법인 동시에 브라우저가 HTML 문서를 조작하는 핵심이기도 하다.

DOM은 트리 구조로 표현한다.
DOM 트리는 노드로 구성된다.
루트 노드를 제외하면 모든 노드에 부모가 있으며, 자식 노드는 있어도 되고 없어도 된다.
루트 노드는 문서이며 자식 노드는 <html> 요소 하나뿐이다.

<html> 요소에는 자식으로 <head> 요소와 <body> 요소가 잇다.

DOM 트리의 모든 노드는 Node 클래스의 인스턴스이다.
Node 객체에는 트리 구조를 나타내는 parentNode와 childNodes 프로퍼티, 자신에 대한 프로퍼티인 nodeName과 nodeType 프로퍼티가 있다.

DOM은 노드로만 구성된다.
하지만 모든 노드가 HTML 요소는 아니다.

모든 노드에는 nodeType, nodeName 프로퍼티가 있다.
nodeType은 그 노드가 어떤 타입인지 나타내는 정수이다.

### 18.3 용어 사용

부모 노드는 직접적인 부모이다, 다시 말해 바로 윗 단계를 말한다.
자식 노드 역시 직접적인 자식이다.
자손은 자식, 자식의 자식 등을 말한다.
조상은 부모, 부모의 부모 등을 말한다.

### 18.4 get 메서드

모든 HTML 요소는 고유한 ID를 할당받을 수 있다.
document.getElementById는 ID를 이용해 요소를 찾는다.

브라우저는 ID가 중복되어도 경고하지 않으므로 HTML 유효성 검사기 등을 통해 유일한 ID를 사용해야 한다.

document.getElementsByClassName는 주어진 클래스 이름에 해당하는 요소들을 반환한다.

document.getElementsByTagName는 주어진 태그 이름에 해당하는 요소들을 반환한다.

### 18.5 DOM 요소 쿼리

querySelector와 querySelectorAll은 CSS 선택자를 사용해 요소를 찾는 메서드이다.

CSS 선택자는 <p>, <div> 같은 요소 이름, ID, 클래스, 클래스의 조합, 요소 이름과 클래스의 조합 등 다양한 방식으로 요소를 찾는다.
CSS 선택자에서 요소 이름을 사용할 때는 꺾쇠 없이 요소 이름만 쓴다.
클래스로 요소를 찾을 때는 클래스 이름 앞에 점을 찍는다.
클래스 여러 개를 사용할 때는 찾으려는 클래스 앞에 모두 점을 찍는다.

CSS 선택자를 사용하면 위치를 기준으로 요소를 찾을 수도 있다.

요소선택자 사이에 스페이스를 넣으면 특정 노드의 자손인 요소를 찾을 수 있다.

요소 선택자 사이에 > 기호를 넣으면 자손이 아니라 자식만 선택한다.

자손 선택자와 자식 선택자를 함께 써도 된다.

### 18.6 DOM 요소 조작

모든 요소에는 textContent와 innerHTML 프로퍼티가 있다.
textContent는 HTML 태그를 모두 제거하고 순수한 텍스트 데이터만 제공하며, innerHTML는 HTML 태그를 그대로 제공한다.

### 18.7 새 DOM 요소 만들기

새로 만든 요소를 DOM에 추가할 때는 insertBefore와 appendChild 메서드를 사용한다.
메서드를 사용하기 위해서는 부모 DOM 요소(<div id="content">)와 그 첫 번째 자식을 찾아야 한다.

insertBefore는 매개변수를 두 개 받는다.
첫 번째 매개변수는 삽입할 요소이고, 두 번째 매개변수는 삽입할 위치를 정하는 요소이다.
appendChild는 항상 마지막 자식 요소로 추가하므로, 삽입할 요소만 매개변수로 제공하면 된다.

### 18.8 요소 스타일링

요소의 스타일을 바꾸고 싶다면 그에 맞는 CSS 클래스를 새로 만들고 그 클래스를 원하는 요소에 지정한다.

모든 요소에는 클래스를 나열하는 classList 프로퍼티가 있다.
classList의 add 메서드로 클래스를 추가할 수 있다.

클래스를 제거할 때는 classList.remove를 사용한다.

### 18.9 데이터 속성

데이터 속성을 사용해 HTML 요소에 임의의 데이터를 추가할 수 있다.
브라우저는 이 데이터를 완전히 무시하므로 자바스크립트에서 쉽게 요소에 관한 정볼르 읽거나 수정할 수 있다.

document.querySelectorAll을 사용해 action 데이터 속성에 "highlight"가 들어있는 요소를 모두 찾을 수 있다.

DOM API는 데이터 속성의 값을 문자열 형태로 저장하므로 객체 데이터는 저장할 수 없다.

자바스크립트에서 데이터 속성을 수정하거나 데이터를 추가하는 것도 간단하다.

### 18.10 이벤트

모든 요소에는 addEventListener라는 메서드가 있다.
이 메서드를 통해 이벤트가 일어났을 때 호출할 함수를 지정할 수 있다.
호출할 함수는 Event 타입의 객체 하나만 매개변수로 받는다.
이벤트 객ㅊ당 이벤트에 관한 정보가 모두 포함되어 있다.

이벤트 모델은 이벤트 하나에 여러 가지 함수(핸들러)를 연결할 수 있도록 설계되어 잇다.
기본 핸들러가 지정된 이벤트도 많다.
기본 핸들러를 막벤트 객체에서 preventDefault()를 호출한다.

#### 18.10.1 이벤트 버블링과 캡처링

HTML은 계층적이므로 이벤트를 꼭 한 곳에서만 처리해야 하는 건 아니다.
여러 요소에서 이벤트를 처리할 수 있다면, 그 이벤트에 응답할 기회는 어떤 순서로 주어지는가 하는 의문이 생길 수 있다.

하나는 가장 먼 조상부터 시작하는 방법으로, 캡처링이라 부른다.

다른 방법은 이벤트가 일어난 요소에서 시작해 거슬러 올라가는 방법이다.
이런 방법을 버블링이라 부른다.

preventDefault 메서드는 이벤트를 취소한다.
취소된 이벤트는 계속 전달되기는 하지만, defaultPrevented 프로퍼티가 true로 바뀐 채 전달된다.
브라우저의 이벤트 핸들러는 defaultPrevented 프로퍼티가 true로 바뀐 이벤트를 무시하고 아무 일도 하지 않는다.
프로그래머가 만든 이벤트 핸들러에서는 defaultPrevented 프로퍼티를 무시한 채 동작을 수행할 수 있고, 보통 그렇게 한다.

stopPropagation 메서드는 이벤트를 현재 요소에서 끝내고 더는 전달되지 않게 막는다.
즉, 해당 요소에 연결된 이벤트 핸들러는 도앚ㄱ하지만 다른 요소에 연결된 이벤트 핸들러는 동작하지 않는다.

stopImmediatePropagation 메서드는 다른 이벤트 핸들러, 심지어 현재 요소에 연결된 이벤트 핸들러도 동작하지 않게 막는다.

캡처링이 먼저 시작되고 그 후에 버블링이 이어진다.
이벤트가 실제 일어난 요소, 즉 버튼에서는 핸들러가 캡처링 다음 버블링이라는 일반적인 순서를 무시하고 추가된 순서대로 실행된다.

addEventListener는 이벤트를 추가하는 구식 방법은 'on' 프로퍼티를 대체할 목적으로 만들어졌다.
이런 문법의 가장 큰 단점은 이벤트에 핸들러 단 하나만 등록할 수 있다는 것이다.

제이쿼리 이벤트 리스너에서 명시적으로 false를 반환하는 것은 stopPropagation을 호출하는 것과 동등한 효과가 있다.
하지만 이것은 제이쿼리의 단축 문법일 뿐이며, DOM API에서는 동작하지 않는다.

#### 18.10.2 이벤트 카테고리

- 드래그 이벤트
  dragstart, drag, dragend, drop 등의 이벤트를 통해 드래그 앤 드롭 인터페이스를 만들 수 있다.

- 포커스 이벤트
  사용자가 폼 필드 같은 편집 가능한 요소를 조작하려 할 때 반응할 수 있다.
  사용자가 필드에 들어갈 때 focus 이벤트가 발생하고, 필드에서 나올 때 blur 이벤트가 발생한다.
  사용자가 필드의 내용을 바꿀 때는 change 이벤트가 발생한다.

- 폼 이벤트
  사용자가 전송 버튼을 클릭하거나, 적절한 위치에서 엔터를 눌러 폼을 전송하면 submit 이벤트가 발생한다.

- 입력 장치 이벤트
  터치 장치의 터치 이벤트는 마우스 이벤트보다 우선한다.
  터치 이벤트를 처리하지 않으면 마우스 이벤트가 발생한다.

- 미디어 이벤트
  HTML5 비디오, 오디오 플레이어에 관련된 이벤트로 pause, play 등이 있다.

- 진행 이벤트
  브라우저가 콘텐츠를 불러오는 과정에서 발생한다.
  가장 널리 쓰이는 것은 브라우저가 요소와 그에 연관된 자원을 모두 불러왔을 때 발생하는 load 이벤트이다.
  error 이벤트도 유용하게 쓸 수 있다.
  자원을 사용할 수 없을 때, error 이벤트를 통해 적절히 대응할 수 있다.

- 터치 이벤트
  터치 이벤트는 장치 터치를 사용할 수 있는 장치를 세밀히 지원한다.
  이벤트의 touches 프로퍼티를 통해 세밀한 터치 처리를 가능하게 한다.

### 18.11 Ajax

Ajax는 원래 비동기적 자바스크립트와 XML의 약어이다.
Ajax를 통해 서버와 비동기적으로 통신하면 페이지 전체를 새로 고칠 필요 없이 서버에서 데이터를 받아올 수 있다.

브라우저 자바스크립트에서 HTTP 요청을 만들어 서버에 보내고 데이터를 받는다.
받는 데이터는 보통 JSON 형식이다.

Ajax 역시 다른 웹 페이지와 마찬가지로 HTTP 위에서 동작하지만, 페이지를 불러오고 렌더링하는 부담이 줄어드므로 웹 어플리케이션이 훨씬 빨라진다.
