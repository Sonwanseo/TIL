# Chapter 20. 노드

노드는 원래 웹 애플리케이션 개발을 목적으로 만들어졌지만, 서버에서 쓰이게 되면서 데스크톱 애플리케이션 개발이나 시스템 스크립트 같은 영역으로도 확장됐다.

### 20.1 노드의 기초

자바스크립트로 프로그램을 만들 수 있으면 노드 애플리케이션도 만들 수 있다.
노드에는 DOM이 없다.

무엇이 자바스크립트이고 무엇이 API의 일부인지 구분할 수 있어야 한다.

### 20.2 모듈

모듈은 패키지를 만들고 코드를 네임스페이스로 구분하는 메커니즘이다.
네임스페이스는 이름 충돌을 방지하는 방법이다.

모듈은 어떤 타입의 값이든 내보낼 수 잇다.
보통은 모듈 하나에 여러 함수를 저장하고, 그 함수를 메서드로 포함하는 객체를 내보내는 것이 일반적이다.

exports를 사용한 단축 문법은 객체를 내보낼 때만 쓸 수 있다.
두 문법을 섞어 쓸 수도 없다.

### 20.3 코어 모듈, 파일 모듈, npm 모듈

모듈은 코어 모듈, 파일 모듈, npm 모듈 세 가지로 나뉜다.
코어 모듈은 fs나 os처럼 노드 자체에서 제공하는 모듈이며, 이들은 모두 예약어이다.
npm 모듈은 특별한 디렉터리 node_modules에 저장되는 모듈 파일이다.
require 함수를 사용하면 노드는 함수의 매개변수를 보고 어떤 타입인지 판단한다.

process와 buffer 같은 일부 코어 모듈은 전역이고 명시적인 require 문 없이 사요앟ㄹ 수 있다.

npm 모듈은 특수한 이름 표기법을 사용하는 파일 모듈이다.
모듈 x를 가져올 때, x가 코어 모듈 이름이 아니라면 노드는 먼저 현재 디렉터리에 node_modules 서브 디렉터리가 있는지 확인한다.
node_modules 서브디렉터리가 있으면 그 안에서 x를 찾는다.
찾지 못하면 부모 디렉터리로 올라가서 node_modules 서브디렉터리가 있는지, 있다면 모듈 x가 있는지 확인한다.
모듈을 찾거나 루트 디렉터리에 도달할 때까지 이 과정을 반복한다.

파일 관련 작업은 모두 npm에서 하도록 해야 한다.

직접 작성하는 모듈을 node_modules에 저장해서는 안된다.

### 20.4 함수 모듈을 통한 모듈 커스터마이징

모듈은 대부분 객체를 내보내지만, 이따금 함수 하나만 내보낼 때도 잇다.
함수 하나만 내보내는 경우는 그 모듈의 함수를 즉시 호출하려는 의도로 만들 때가 대부분이다.
이런 패턴은 모듈을 일부 커스터마이즈 하거나, 주변 컨텍스트에서 정보를 얻어야 할 때 주로 사용한다.

노드는 노드 앱을 실행할 때 어떤 모듈이든 단 한 번만 임포트한다.

### 20.5 파일 시스템 접근

write.js 파일을 저장한 디렉터리에 쓰기 권한이 있고, 읽기 전용 hello.txt 파일이 이미 존재하지 않으면 hello.txt 파일이 생성될 것이다.
노드 애플리케이션을 실행하면 해당 애플리케이션은 자신이 실행된 현재 작업 디렉터리를 \_\_dirname 변수로 보관한다.

문자열 병합으로 \_\_dirname과 파일 이름을 합쳐서 파일 경로를 얻으면 운영체제에 따라 호환되지 않을 수 있다.
노드의 path 모듈에는 운영체제 독립적인 경로 이름 유틸리티가 있다.

path.join은 운영체제에 따라 디렉터리 구분자를 알맞게 사용한다.

파일 콘텐츠를 읽을 때는 fs.readFile을 사용한다.

fs.readFile에 인코딩 정보를 제공하지 않으면 fs.readFile은 가공되지 않은 바이너리 데이터인 버퍼를 반환한다.

파일 관련 함수에는 모두 동기적으로 작업하는 짝이 있으며, 이들의 이름은 Sync으로 끝난다.

동기적인 함수에서는 try/catch 블록을 통해 예외 처리를 한다.

디렉터리에 어떤 파일이 있는지 알아보려면 fs.readdir을 사용한다.

파일을 지울 때는 fs.unlink
파일을 옮기거나 이름을 바꿀 때는 fs.rename
파일과 디렉터리 정보를 얻을 때는 fs.stat

### 20.6 process

실행 중인 노드 프로그램은 모두 process 변수에 접근할 수 있다.
이 변수는 해당 프로그램에 관한 정보를 담고 있으며 실행 자체를 컨트롤할 수도 있다.

숫자형 종료 코드를 쓰면 프로그램이 성공적으로 종료됐는지 에러가 있었는지 외부 스크립트에서도 알 수 있다.

process 객체를 통해 프로그램에 전달된 명령줄 매개변수 배열에 접근할 수도 있다.
노드 애플리케이션을 실행할 때 명령줄에서 매개변수를 지정할 수 있다.

명령줄 매개변수는 process.argv 배열에 저장된다.

첫 번재 요소는 인터프리터, 즉 소스 파일을 해석한 프로그램이다.
두 번째 요소는 실행 중인 프로그램의 전체 경로이며, 나머지 요소는 프로그램에 전달된 매개변수이다.

process.env를 통해 환경 변수에 접근할 수도 있다.
환경 변수는 시스템 변수이며 주로 명령줄 프로그램에서 사용한다.

환경 변수를 활용하면 프로그램을 실행할 때마다 명령줄에서 매개변수로 지정할 필요가 없다.

현재 작업 디렉터리의 기본값은 프로그램을 실행한 디렉터리이다.
process.cwd에는 현재 작업 디렉터리가 저장되며, process.chdir로 현재 작업 디렉터리를 바꿀 수 있다.
