# 19. 테스팅

## 테스팅 개요

React 컴포넌트를 테스트할 수 있는 몇 가지 방법이 있는데 크게 2가지 카테고리로 나누어진다.

- 컴포넌트 트리 렌더링: 간략화된 테스팅 환경 및 출력값이 확실한 경우
- 완성된 앱에서의 테스트: 현실적 브라우저 환경(End To End Test)

### 트레이드오프

테스팅 도구를 선택할 때 몇 가지 트레이드오프를 생각하는 것은 의미 있는 일이다.

- 반복작업 속도 vs 현실적인 개발 환경: 몇몇 도구들은 변경사항이 생기고 결과 값이 출력되는 과정에서 매우 빠른 피드백 루프를 제공하지만 브라우저 동작을 정확히 구현하지 않는다.  
  다른 도구들이 현실적 브라우저 환경에서 사용되지만 반복 작업 속도를 저하시키고 지속적 통합 서버 환경에서 더 연약하다.
- 얼마나 다양한 방법을 통해 실제 테스트 환경의 동작을 테스트할 것인가?  
  컴포넌트 안에서는 유닛 테스트와 통합 테스트의 차이는 명확하지 않다.

### 추천 도구

Jest는 jsdom을 통해 DOM에 접근하게 하는 JavaScript 테스트 러너다.  
jsdom은 단지 어떻게 브라우저가 작동하는지에 대한 대략적 개요이다.  
하지만 이는 React 컴포넌트를 테스팅하기에 충분하다.  
Jest는 mocking modules과 timers 같은 파워풀한 특징과 결합되어 훌륭한 반복속도를 제공한다.  
그래서 더 많은 코드 제어를 가진다.

React Testing Library는 실행 디테일을 가지지 않는 React 컴포넌트를 테스트하게 하는 도구 모음이다.  
이러한 접근은 리팩토링을 수월하게 하며 접근성에 대한 가장 좋은 연습을 가능하게 한다.  
자식 컴포넌트를 가지지 않는 컴포넌트에 대한 얕은 렌더링 방법을 제공하지 않더라도 Jest와 같은 테스트 러너는 mocking에 의해 위를 가능하게 한다.

## 테스트 환경

### 테스트 러너

Jest, Mocha, ava와 같은 테스트 러너는 테스트 스위트를 일반 자바스크립트로 작성하고, 개발 프로세스의 일부로 실행할 수 있도록 한다.  
추가적으로, 테스트 스위트는 지속적 통합의 일부로 실행된다.

- Jest는 모의 모듈 및 타이머, 그리고 jsdom 지원 등 여러 기능을 지원하는 React 프로젝트와 광범위하게 호환된다.  
  create-react-app으로 project를 생성하면, Jest는 유용한 기본값과 함께 포함되어 있다.
- mocha 같은 라이브러리는 실제 브라우저 환경에서도 잘 작동하며, 이는 분명히 필요한 테스트에 도움이 될 수 있다.
- 엔드 투 엔드 테스트는 여러 페이지에 걸친 긴 흐름을 테스트하기 위해 사용되며, 다른 설정이 필요하다.

### 렌더링 표면에 대한 모의하기

테스트는 종종 브라우저와 같은 실제 렌더링 표면에 접근하지 않은 환경에서도 진행된다.  
이런 환경에서는, Node.js 내에서 실행되는 가벼운 브라우저인 jsdom을 사용하여 브라우저를 시뮬레이션하는 것을 권장한다.

대체로, jsdom은 일반 브라우저처럼 동작하지만 레이아웃이나 탐색과 같은 기능은 가지고 있지 않다.  
이는 대부분의 웹 기반 컴포넌트 테스트에 유용하다.  
테스트를 위해 브라우저를 시작하는 것보다 빨리 실행되기 때문이다.  
또한 테스트와 동일한 프로세스에서 실행되므로, 렌더링된 DOM을 검토하고 검증할 코드를 작성할 수 있다.

실제 브라우저와 마찬가지로, jsdom은 사용자 상호작용을 모델링할 수 있도록 한다.  
테스트는 DOM 노드에서 이벤트를 발송한 다음 이러한 동작의 부작용을 관찰하고 검증할 수 있다. 

만약 대부분의 브라우저별 동작을 테스트하고 레이아웃이나 실제 입력과 같은 네이티브 브라우저 동작을 요구하는 라이브러리를 작성하는 경우 mocha와 같은 프레임 워크를 사용할 수 있다.

DOM을 시뮬레이션할 수 없는 환경에서, 엘리먼트와의 상호작용을 시뮬레이션하기 위해 이벤트 시뮬레이션 헬퍼를 사용할 수 있다.

Cypress, puppeteer, webdriver 같은 프레임워크들은 end-to-end 테스트를 진행하기에 유용하다.

### 함수 모의하기

모의 함수는 특히 데이터를 불러올 때 유용하다.  
실제 API end Point로부터 발생하는 느려짐과 손상을 방지하기 위해 테스트에 "가짜" 데이터를 사용하는 것이 바람직한 방법이다.  
이는 테스트를 예측 가능하게 만들어준다.  
Jest와 sinon과 같은 라이브러리들은 모의 함수들을 지원한다.  
엔드 투 엔드 테스트의 경우 네트워크를 모사하는 것은 어려울 수 있지만, 실제 API end Point를 테스트하기를 원할 수도 있다.

### 모듈 모의하기

일부 컴포넌트는 테스트 환경에서 잘 작동하지 않거나 테스트에 필수적이지 않은 모듈에 대한 의존성을 가지고 있다.  
적절한 교체를 통해 이러한 모듈을 선택적으로 모의하는 것이 유용할 수 있다.

Node.js에서 Jest같은 러너는 모의 모듈을 지원한다.  
또한 mock-require 라이브러리도 사용할 수 있다.

### 타이머 모의하기

컴포넌트는 setTimeout, setInterval, Date.now와 같은 시간을 기반으로한 함수를 사용할 수 있다.  
테스트 환경에서, 이러한 함수들을 수동으로 발전할 수 있는 대체품으로 모의하는 것이 유용할 수 있다.  
이것은 테스트가 빨리 진행되도록 하는 데 좋다.  
타이머에 의존하는 테스트는 여전히 순서대로 해결되지만 더 빨리 해결된다.  
Jest, sinon, lolex를 포함한 대부분의 프레임워크는 테스트에서 타이머를 모의할 수 있게 해준다.

모의 타이머를 원하지 않는 경우가 있을 수도 있다.  
타이머 모의가 있는 라이브러리는 테스트/묶음별로 활성화 및 비활성화할 수 있으므로 이러한 테스트 실행 방법을 명시적으로 선택할 수 있다.

### 엔드 투 엔드 테스트

엔드 투 엔드 테스트는 더 긴 작업흐름을 테스트하는 데 유용하며, 특히 비즈니스에 중요한 작업흐름을 테스트하는 데 유용하다.

Cypress와 같은 프레임워크나 puppeteer 같은 라이브러리를 사용하여 여러 경로를 탐색하고 브라우저뿐만 아니라 잠재적으로 백엔드에서도 부작용에 대해 주장할 수 있다.