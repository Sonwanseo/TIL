# 11. ErrorBoundary

[깃허브](https://github.com/sangheon-kim/React-docs-analyze/tree/master/src/Pages/9.ErrorBoundary)  
[공식문서](https://ko.reactjs.org/docs/error-boundaries.html)

### 에러 경계의 소개

UI의 일부분에 존재하는 자바스크립트 에러가 전체 애플리케이션을 중단시키는 문제를 해결하기 위해 React 16에서는 에러 경계라는 새로운 개념이 도입되었다.

에러 경계는 하위 컴포넌트 트리의 어디에서든 자바스크립트 에러를 기록하며 깨진 컴포넌트 트리 대신 폴백 UI를 보여주는 React 컴포넌트이다.  
에러 경계는 렌더링 도중 생명주기 메서드 및 그 아래에 있는 전체 트리에서 에러를 잡아낸다.

에러 경계는 다음과 같은 에러는 포착하지 않는다.

- 이벤트 핸들러
- 비동기적 코드(setTimeout Or requestAnimationFrame 콜백)
- 서버 사이드 렌더링
- 자식에서가 아닌 에러 경계 자체에서 발생하는 에러

생명주기 메서드인 static getDerivedStateFromError()와 componentDidCatch() 중 하나(혹은 둘 다)를 정의하면 클래스 컴포넌트 자체가 에러 경계가 된다.  
에러가 발생한 뒤에 폴백 UI를 렌더링하려면 static getDerivedStateFromError()를 사용하자.  
에러 정보를 기록하려면 componentDidCatch()를 사용하자.

에러 경계는 자바스크립트의 catch {} 구문과 유사하게 동작하지만 컴포넌트에 적용된다.  
오직 클래스 컴포넌트만이 에러 경계가 될 수 있다.

에러 경계는 트리 내에서 하위에 존재하는 컴포넌트의 에러만을 포착한다.  
에러 경계 자체적으로는 에러를 포착할 수 없다.

### 에러 경계를 배치할 위치

에러 경계의 세분화된 부분은 개발자에게 달려있다.  
서버 사이드 프레임워크가 충돌을 해결하는 것처럼 최상위 경로의 컴포넌트를 감싸서 유저에게 "문제가 발생했습니다"라는 메시지를 보여줄 수 있다.  
또한 에러 경계의 각 위젯을 에러 경계로 감싸서 애플리케이션의 나머지 부분이 충돌하지 않도록 보호할 수도 있다.

### 포착되지 않은 에러에 대한 새로운 동장

React 16부터는 에러 경계에서 포착되지 않은 에러로 인해 전체 React 컴포넌트 트리의 마운트가 해제된다.

### 컴포넌트 스택 추적

React 16은 애플리케이션이 실수로 에러를 집어삼킨 경우에도 개발 과정에서 렌더링하는 동안 발생한 모든 에러를 콘솔에 출력한다.  
에러 메시지 및 자바스크립트 스택과 더불어 React 16은 컴포넌트 스택 추적 또한 제공한다.

또한 컴포넌트 스택 추적 내에서 파일 이름과 줄 번호도 확인할 수 있다.

### try/catch는 어떤가요?

try/catch는 명령형 코드에서만 동작한다.

그러나 React 컴포넌트는 선언적이며 무엇을 렌더링할지 구체화한다.

에러 경계는 React의 선언적인 특성을 보존하고 예상한 대로 동작한다.

### 이벤트 핸들러는 어떤가요?

에러 경계는 이벤트 핸들러 내부에서는 에러를 포착하지 않는다.

React는 이벤트 핸들러의 에러를 해결하기 위해 에러 경계를 필요로 하지 않는다.  
render 메서드 및 생명주기 메서드와 달리 이벤트 핸들러는 렌더링 중에 발생하지 않는다.  
따라서 이벤트 핸들러가 에러를 던져도 React는 여전히 화면에 무엇을 표시해야 할 지 알고 있다.

이벤트 핸들러 내에서 에러를 잡아야 하는 경우에 일반 자바스크립트의 try/catch 구문을 사용하자.

### React 15에서 변경된 명명법

React 15는 unstable_handleError라는 다른 메서드 이름으로 에러 경계에 대해 매우 제한적인 지원을 포함하고 있었다.  
이 메서드는 더 이상 동작하지 않으며 첫 16 베타 릴리즈부터 코드에서 componentDidCatch로 변경해야 한다.