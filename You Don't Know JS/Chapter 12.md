# Chapter 12. 벤치마킹과 튜닝

## 12.1 벤치마킹

p. 375 ~ 376 참고

### 12.1.1 반복

p. 377 참고

### 12.1.2 Benchmark.js

유의미한, 신뢰할 수 있는 벤치마킹은 반드시 통계적으로 검증된 지침에 근거함

다음 예제를 보면 Benchmark.js로 신속하게 성능 테스트 하는 방법을 알 수 있음

```javascript
function foo() {
  // 테스트할 작업(들)
}

var bench = new Benchmark(
  "foo text", // 테스트 명
  foo, // 테스트할 함수 (내용만)
  {
    // ... // 추가 옵션 (문서 참조)
  }
);

bench.hz; // 초당 작업 개수
bench.stats.moe; // 한계 에러
bench.stats.variance; // 분산
```

Benchmark.js는 브라우저 환경의 자바스크립트 테스팅에 주로 쓰지만 브라우저 이외의 환경에서도 사용 가능

##### 설정/정리

p. 379 ~ 380 참고

## 6.2 콘텍스트가 제일

X, Y 작업 간 성능 비교 등 특정한 성능 벤치마킹을 할 때 콘텍스트를 살피는 걸 명심  
테스트 결과, X과 Y보다 빠른 것처럼 나왔다고 해서 실제로 "X가 Y보다 빠르다"고 결론 내릴 수 없음

### 6.2.1 엔진 최적화

p. 381 ~ 383 참고

## 6.3 jsPerf.com

jsPerf는 접속 가능한 공개 URL에 대하여 앞서 소개한 Benchmark.js 라이브러리를 이용하여 통계적으로 정확하고 믿음성 있는 테스트를 대행  
테스트를 할 때마다 결과를 수집/저장하고 다른 사람도 볼 수 있도록 한 페이지에 누적 테스트 결과를 그래프로 보여줌

### 6.3.1 정상 테스트

p. 384 ~ 387 참고

## 6.4 좋은 테스트를 작성하려면

좋은 테스트를 작성하고 싶다면 두 테스트 케이스 사이의 차이점은 무엇인지, 그 차이점은 '의도적인지 비의도적인지'를 철저하게 분석하고 고민해야 함

의도적인 차이는 아무 문제가 없는 반면, 비의도적인 차이는 쉽게 발생하고 테스트 결과를 왜곡함

좋은 테스트를 작성하는 방법은 더 나은, 더 명확한 테스트를 작성하는 것  
정확한 테스트 의도가 무엇인지 미묘한 세부분까지 시간을 들여 문서화하라

또한, 테스트와 크게 상관없는 부분은 페이지나 테스트 설정부에 미리 선언하는 형태로 따로 빼내어 테스트에 포함 X

## 6.5 미시성능

성능 벤치마킹을 할 때는 우선 자신이 작성한 코드와 실제로 엔진이 실행하는 코드가 같지 않을 수 있다는 사실을 당연하게 받아들여야 함

p. 390 ~ 391 참고

### 6.5.1 똑같은 엔진은 없다

상이한 브라우저에 탑재된 각 자바스크립트 엔진의 코드 처리 방식은 제각각임

p. 392 ~ 394 참고

### 6.5.2 큰 그림

p. 394 ~ 396 참고

## 6.6 꼬리 호출 최적화(CTO)

ES6부터는 특정한 성능 요건이 한 가지 추가되었음  
함수 호출과 관련된 특수한 형태의 최적화, 즉 '꼬리 호출 최적화'에 관한 내용  
꼬리 호출은 함수 호출부가 다른 함수의 '꼬리' 부분에 있고 호출이 끝나면 더 이상 수행할 작업을 남기지 않는 방식

p. 396 ~ 398 참고

## 6.7 정리하기

코드 조각을 효과적으로 벤치마킹하려면, 특히 같은 코드에 대해 여러 가지 옵션이 있고 그중 어느 것이 더 빠른지 결정해야 하는 상황이라면 일단 자세한 내막을 살펴야 함
