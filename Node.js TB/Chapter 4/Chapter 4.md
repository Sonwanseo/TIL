# http 모듈로 웹 서버 만들기

## 4.1 요청과 응답 이해하기

클라이언트에서 서버로 요청을 보내고, 서버에서는 요청의 내용을 읽고 처리한 뒤 클라이언트에게 응답을 보냅니다.

요청과 응답은 이벤트 방식이라고 생각하면 됩니다.
클라이언트로부터 요청이 왔을 때 어떤 작업을 수행할지 이벤트 리스너를 미리 등록해두어야 합니다.

http 모듈에는 createServer 메서드가 있습니다.
인자로 요청에 대한 콜백 함수를 넣을 수 있습니다.

createServer의 콜백 부분을 보면 req와 res 매개변수가 있습니다.
req 객체는 요청에 관한 정보들을, res 객체는 응답에 관한 정보들을 담고 있습니다.

createServer 메서드 뒤에 listen 메서드를 붙이고 클라이언트에서 공개할 포트 번호와 포트 연결 완료 후 실행될 콜백 함수를 넣어줍니다.

res 객체에는 res.write와 res.end 메서드가 있습니다.
res.write의 첫 번째 인자는 클라이언트로 보낼 데이터입니다.

res.end는 응답을 종료하는 메서드입니다.
인자가 있다면 그 데이터도 클라이언트로 보내고 응답을 종료합니다.

localhost는 현재 컴퓨터의 내부 주소를 가리킵니다.
외부에서는 접근할 수 없고 자신의 컴퓨터에서만 접근할 수 있습니다.
숫자 주소를 IP라고 부릅니다.

포트는 서버 내에서 프로세스를 구분하는 번호입니다.
서버는 HTTP 요청을 대기하는 것 외에도 다양한 작업을 합니다.

## 4.2 쿠키와 세션 이해하기

클라이언트에서 보내는 요청에는 한가지 큰 단점이 있습니다.
바로 누가 요청을 보내는지 모른다는 것이빈다.

웹 사이트에 방문해서 로그인을 할 때 내부적으로는 쿠키와 세션을 사용하고 있습니다.
로그인한 후에는 새로고침(새로운 요청)을 해도 로그아웃되지 않는 이유는 바로 클라이언트가 서버에게 누구인지를 지속적으로 알려주고 있기 때문입니다.

누구인지 기억하기 위해서, 서버는 요청에 대한 응답을 할 때 쿠키라는 것을 같이 보내줍니다.
쿠키는 단순한 '키-값'의 쌍입니다.
서버로부터 쿠키가 오면 웹 브라우저는 쿠키를 저장해두었다가 요청할 때마다 쿠키를 동봉해서 보내줍니다.
서버는 요청에 들어 있는 쿠키를 읽어서 사용자가 누구인지 파악합니다.

브라우저는 쿠키가 있다면 자동으로 동봉해서 보내주므로 서버에서 브라우저로 쿠키를 보낼 때만 코드를 작성하여 처리하면 됩니다.

쿠키는 요청과 응답의 헤더에 저장됩니다.
요청과 응답은 각각 헤더와 본문을 가집니다.

쿠키는 req.headers.cookie에 들어 있습니다.
req.headers는 요청의 헤더를 의미합니다.

req.url은 주소의 path와 search 부분을 알려줍니다.

파비콘이란 웹 사이트 탭에 보이는 이미지를 뜻합니다.

브라우저는 파비콘이 뭔지 HTML에서 유추할 수 없으면 서버에 파비콘 정보에 대한 요청을 보냅니다.

브라우저는 서버에서 보내주는 상태 코드를 보고 요청이 성공했는지 실패했는지를 판단합니다.

요청과 응답은 모두 헤더와 본문을 가지고 있습니다.
헤더는 요청 또는 응답에 대한 정보를 가지고 있는 곳이고, 본문은 서버와 클라이언트 간에 주고받을 실제 데이터를 담아두는 공간입니다.
쿠키는 부가적인 정보이므로 헤더에 저장합니다.

크롬 개발자 도구의 Network 탭에서 요청과 응답을 살펴볼 수 있습니다.

## 4.3 REST API와 라우팅

서버에 요청을 보낼 때는 주소를 통해 요청의 내용을 표현합니다.

요청이 주소를 통해 들어오므로 서버가 이해하기 쉬운 주소를 사용하는 것이 좋습니다.

REST API는 네트워크 구조의 한 형식인데요, 서버의 자원을 정의하고, 자원에 대한 주소를 지정하는 방법을 가리킵니다.
주소는 의미를 명확히 전달하기 위해 명사로 구성됩니다.

REST API는 주소 외에도 HTTP 요청 메서드라는 것을 사용합니다.

주소 하나가 요청 메서드를 여러 개 가질 수 있습니다.

주소와 메서드만 보고 요청의 내용을 명확하게 알아볼 수 있다는 것이 장점입니다.

HTTP 프로토콜을 사용하면 클라이언트가 누구든 상관없이 서버와 소통할 수 있습니다.
iOS, 안드로이드, 웹이 모두 같은 주소로 요청을 보낼 수 있습니다.
즉, 서버와 클라이언트가 분리되어 있다는 뜻입니다.

REST API를 따르는 서버를 RESTful하다고 표현합니다.

요청이 어떤 메서드를 사용했는지 req.method로 알 수 있습니다.

Network 탭에서 네트워크 요청 내용을 실시간으로 볼 수 있습니다.
REST API 방식으로 주소를 만들었으므로 주소만 봐도 요청 내용을 유추할 수 있다.

데이터는 메모리상의 변수에 저장되어 있으므로 서버를 종료하기 전까지 유지됩니다.

## 4.4 https와 http2

https 모듈은 웹 서버에 SSL 암호화를 추가합니다.
GET이나 POST 요청을 할 때 오고 가는 데이터를 암호화해서 중간에 다른 사람이 요청을 가로채더라도 내용을 확인할 수 없게 해줍니다.

서버에 암호화를 적용하려면 https 모듈을 사용해야 합니다.

createServer 메서드가 인자를 두 개 받습니다.
두 번째 인자는 http 모듈과 같이 서버 로직이고, 첫 번째 인자는 인증서에 관련된 옵션 객체입니다.
인증서를 구입하면 pem이나 crt, 또는 key 확장자를 가진 파일들을 제공해줍니다.
파일들을 fs.readFileSync 메서드로 읽어서 cert, key, ca 옵션에 알맞게 넣어주면 됩니다.

## 4.5 cluster

cluster 모듈은 싱글 스레드인 노드가 CPU 코어를 모두 사용할 수 있게 해주는 모듈입니다.
코어를 하나만 사용할 때에 비해 성능이 개선됩니다.
세션을 공유하지 못하는 등의 단점도 있습니다.

클러스터에는 마스터 프로세스와 워커 프로세스가 있습니다.
마스터 프로세스는 CPU 개수만큼 워커 프로세스를 만들고, 8085번 포트에서 대기합니다.
요청이 들어오면 만들어진 워커 프로세스에 요청을 분배합니다.

워커 프로세스가 실질적인 일을 하는 프로세스입니다.

process.pid는 매 실행 시마다 달라집니다.
