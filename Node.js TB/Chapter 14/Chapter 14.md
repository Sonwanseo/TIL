# Chapter 14. CLI 프로그램 만들기

CLI는 콘솔 창을 통해서 프로그램을 수행하는 환경을 뜻합니다.
반대 개념으로는 그래픽 사용자 인터페이스가 있습니다.
리눅스의 셀이나 브라우저의 콘솔, 명령 프롬프트 등이 대표적인 CLI 방식 소프트웨어고, 윈도나 맥 운영체제, 웹 애플리케이션 등이 대표적인 GUI 방식 소프트웨어입니다.

개발자에게는 GUI 프로그램보다 CLI 프로그램이 더 효율적일 수 있습니다.
GUI를 만드는 데 상당한 시간이 소요되기 때문입니다.
GUI가 없어도 되는 간단한 개발용 프로그램이 필요하다면 노드를 통해 CLI 프로그램을 만들어 시간을 아낄 수 있습니다.

## 14.1 간단한 콘솔 명령어 만들기

node나 npm, nodemon처럼 콘솔에서 입력하여 어떠한 동작을 수행하는 문장을 콘솔 명령어라고 부릅니다.

node와 npm 명령어는 노드를 설치해야만 사용할 수 있지만, 신기하게도 nodemon, rimraf와 같은 명령어는 해당 패키지를 npm을 통해 전역(-g 옵션) 설치하면 콘솔에서 명령어로 사용할 수 있었습니다.

명령어로 만들고 싶은 패키지가 다른 사람의 소유더라도 걱정할 필요가 없습니다.

패키지명과 콘솔 명령어를 다르게 만들 수 있으니 걱정하지 않아도 됩니다.

index.js는 단순히 Hello CLI라는 문자열을 콘솔에 출력하는 파일이지만, 첫 줄의 주석이 눈에 띕니다.
주석이라 의미 없는 문장이라고 생각할 수도 있지만, 리눅스나 맥 같은 유닉스 기반 운영체제에서는 의미가 있습니다.
/usr/bin/env에 등록된 node 명령어로 이 파일을 실행하라는 뜻입니다.
윈도 운영체제에서는 단순한 주석으로 취급합니다.

bin 속성이 콘솔 명령어와 해당 명령어 호출 시 실행 파일을 설정하는 객체입니다.

process.argv로 명령어에 어떤 옵션이 주어졌는지 확인할 수 있습니다.

코드가 업데이트될 때마다 다시 설치할 필요는 없습니다.
package.json의 bin 속성에 cli ㅁ열여어와 index.js를 연결해두었으므로 cli 명령어가 호출될 때마다 index.js 파일이 실행됩니다.
index.js의 내용을 캐싱하는 것이 아니고, 호출 시마다 새로 읽어들이므로 항상 업데이트 내용이 반영됩니다.

이번에는 사용자로부터 입력을 받아봅시다.
노드의 내장 모듈인 readline을 사용합니다.

readline 모듈을 불러와서 createInterface 메서드로 rl 객체를 생성합니다.
인자로 설정 객체를 제공했는데요.
input 속성에는 process.stdin을, output 속성에는 process.stdout을 넣어주었습니다.
process.stdin과 process.stdout은 각각 콘솔 입력과 출력을 담당하는 스트림입니다.
readline 모듈은 이들을 사용해서 사용자로부터 입력을 받고, 그에 따른 결과를 출력합니다.

rl 객체의 question 메서드의 첫 번째 인자가 질문 내용입니다.
두 번째로 인자로 받는 콜백 함수는 매개변수로 답변을 가지고 있습니다.

콘솔 내용을 지우려면 console.clear 메서드를 호출하면 됩니다.

CLI 프로그램 명령어를 입력하면 기본적인 html 또는 익스프레스 라우터 파일 템플릿을 만들어주는 코드입니다.
cli html main ./public/html 같은 명령어를 입력하면 public 폴더 안에 있는 html 폴더 안에 main.html이 생기는 식입니다.

public, html, routes 폴더가 생기고 그 안에 main.html과 index.js가 들어 있을 것입니다.
파일 생성 경로는 콘솔에 명령어를 입력한 경로를 기준으로 합니다.
이렇게 자주 사용하는 것들은 템플릿으로 만들어두면 좋습니다.

위 방식의 단점은 사용자가 명령어와 명령어 옵션 순서를 모두 외우고 있어야 한다는 것입니다.
명령어를 외우고 있다면 빠르게 작업을 수행할 수 있겠지만, 모른다면 사용 방법부터 찾아보아야 합니다.

question 메서드가 비동기 방식으로 동작하므로 새로운 함수들을 만들었습니다.

예전처럼 cli html test public 명령어도 가능합니다.
다만 명령어를 외우지 못한 사람에게는 위의 방식이 더 편리할 것입니다.

## 14.2 Commander, Inquirer 사용하기

npm에는 CLI 프로그램을 위한 라이브러리가 많이 준비되어 있습니다.
대표적인 것으로 yargs, commander, meow가 있습니다.

yargs나 meow나 훌륭한 라이브러리지만, commander가 사용 방법이 좀더 직관적입니다.
commander와 더불어 CLI 프로그램과 사용자 간의 상호작용을 돕는 inquirer 패키지, 콘솔 텍스트에 스타일을 추가하는 chalk 패키지도 함께 사용합니다.

commander 패키지로부터 program 객체를 불러왔습니다.
program 객체에는 다양한 메서드가 존재합니다.

- version: 프로그램의 버전을 설정할 수 있습니다.
  첫 번째 인자로 버전을 넣어주고, 두 번째 인자로 버전을 보여줄 옵션을 넣어줍니다.
  여러 개인 경우 쉼표(,)로 구분하면 됩니다.
  현재 --version으로 지정되어 있고, -v는 축약 옵션입니다.
  node -v나 npm -v처럼 cli -v로 프로그램의 버전을 확인할 수 있습니다.
- usage: 이 메서드를 사용하면 명령어의 사용법을 설정할 수 있습니다.
  사용법은 명령어에 도움 옵션(-h 또는 --help)을 붙였을 때 나타나는 설명서에 표시됩니다.
  설명서는 commander가 자동으로 생성합니다.
  [options]라고 되어 있는데, []는 필수가 아닌 선택이라는 뜻입니다.
  즉, 옵션을 넣어도 되고 안 넣어도 됩니다.
- command: 명령어를 설정하는 메서드입니다.
  <>는 필수라는 의미라서 type을 넣지 않으면 에러가 발생합니다. \*는 와일드카드 명령어로, 나머지 모든 명령어를 의미합니다.
  Template을 제외한 다른 명령어를 입력했을 때 실행됩니다.
- description: 명령어에 대한 설명을 설정하는 메서드입니다.
- alias: 명령어의 별칭을 설정할 수 있습니다.
- option: 명령어에 대한 부가적인 옵션을 설정할 수 있습니다.
  이 메서드의 첫 번재 인자가 옵션 명령어고, 두 번째 인자가 옵션에 대한 설명입니다.
  마지막 인자는 옵션 기본값입니다.
  옵션을 입력하지 않았을 경우 자동으로 기본값이 적용됩니다.
- action: 명령어에 대한 실제 동작을 정의하는 메소드입니다.
  <type> 같은 필수 요소나 옵션들을 매개변수로 가져갈 수 있습니다.
- help: 설명서를 보여주는 옵션입니다.
- parse: program 객체의 마지막에 붙이는 메서드입니다.
  process.argv를 인자로 받아서 명령어와 옵션을 파싱합니다.

명령어에 -h 옵션을 붙이면 명령어 설명서가 나옵니다.

옵션들은 순서를 바꿔서 입력해도 됩니다.
미리 등록하지 않은 명령어를 사용하면 \* 와일드카드 명령어가 실행됩니다.

commander에서 알아두어야 할 것은 기본 명령어(cli)는 \* 명령어에 해당하지 않는다는 것입니다.
이 명령어에 동작을 추가하기 위해서는 parse 메서드 다음에 별도로 동작을 정의해주어야 합니다.
