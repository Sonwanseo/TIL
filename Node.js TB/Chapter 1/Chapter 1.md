# Chapter 1. 노드 시작하기

## 1.1 핵심 개념 이해하기

노드의 공식 사이트 설명

Node.js는 크롬 V8 자바스크립트 엔진으로 빌드된 자바스크립트 런타입입니다.
Node.js는 이벤트 기반, 논블로킹 I/O 모델을 사용해 가볍고 효율적입니다.
Node.js의 패키지 생태계인 npm은 세계에서 가장 큰 오픈 소스 라이브러리 생태계이기도 합니다.

### 1.1.1 서버

서버는 네트워크를 통해 클라이언트에 정보나 서비스를 제공하는 컴퓨터 또는 프로그램을 말합니다.
클라이언트란 요청을 보내는 주체로, 브라우저일 수도 있고, 데스크톱 프로그램일 수도 있고, 모바일 앱일 수도 있고, 다른 서버에 요청을 보내는 서버일 수도 있습니다.

서버는 클라이언트의 요청에 대해 응답을 합니다.

노드는 자바스크립트 애플리케이션이 서버로서 기능하기 위한 도구를 제공하므로 서버 역할을 수행할 수 있습니다.

### 1.1.2 자바스크립트 런타임

노드는 자바스크립트 런타임입니다.
런타임은 특정 언어로 만든 프로그램들을 실행할 수 있는 환경을 뜻합니다.
따라서 노드는 자바스크립트 프로그램을 컴퓨터에서 실행할 수 있게 해줍니다.

노드는 V8과 더불어 libuv라는 라이브러리를 사용합니다.

libuv 라이브러리는 노드의 특성인 이벤트 기반, 논블로킹 I/O 모델을 구현하고 있습니다.

### 1.1.3 이벤트 기반

이벤트 기반이란 이벤트가 발생할 때 미리 지정해둔 작업을 수행하는 방식을 의미한다.
이벤트로는 클릭이나 네트워크 요청 등이 있을 수 있습니다.

이벤트 기반 시스템에서는 특정 이벤트가 발생할 때 무엇을 할지 미리 등록해두어야 합니다.
이것을 이벤트 리스너에 콜백 함수를 등록한다고 표현합니다.

노드도 이벤트 기반 방식으로 동작하므로 이벤트가 발생하면 이벤트 리스너에 등록해둔 콜백 함수를 호출합니다.

이벤트 기반 모델에서는 이벤트 루프라는 개념이 등장합니다.
여러 이벤트가 동시에 발생했을 때 어떤 순서로 콜백 함수를 호출할지를 이벤트 루프가 판단합니다.

노드는 자바스크립트 코드에서 맨 위부터 한 줄씩 실행합니다.
함수 호출 부분을 발견했다면 호출한 함수를 호출 스택에 넣습니다.

main 함수는 처음 실행 시의 전역 컨텍스트를 의미합니다.
컨텍스트는 함수가 호출되었을 때 생성되는 환경을 의미합니다.
함수의 실행이 완료되면 호출 스택에서 지워집니다.

- 이벤트 루프: 이벤트 발생 시 호출할 콜백 함수들을 관리하고, 호출된 콜백 함수의 실행 순서를 결정하는 역할을 담당합니다. 노드가 종료될 때까지 이벤트 처리를 위한 작업을 반복하므로 루프라고 불립니다.
- 태스크 큐: 이벤트 발생 후 호출되어야 할 콜백 함수들이 기다리는 공간입니다. 콜백들이 이벤트 루프가 정한 순서대로 줄을 서 있으므로 콜백 큐라고도 부릅니다.
- 백그라운드: 타이머나 I/O 작업 콜백 또는 이벤트 리스너들이 대기하는 곳입니다.

태그크 큐는 실제로 여러 개의 큐로 이루어져 있습니다.
이벤트 루프는 정해진 규칙에 따라 콜백 함수들을 호출 스택으로 부릅니다.

### 1.1.4 논블로킹 I/O

이벤트 루프를 잘 활용하면 오래 걸리는 작업을 효율적으로 처리할 수 있습니다.
논블로킹이란 이전 작업이 완료될 때까지 멈추지 않고 다음 작업을 수행함을 뜻합니다.

하지만 싱글 스레드라는 한계 때문에 자바스크립트의 모든 코드가 이 방식으로 시간적 이득을 볼 수 있는 것은 아닙니다.

I/O는 입력/출력을 의미합니다.
파일 시스템 접근(파일 읽기, 쓰기, 폴더 만들기 등)이나 네트워크 요청 같은 작업이 I/O의 일종입니다.
이러한 작업을 할 때 노드는 논블로킹 방식으로동작합니다.

setTimeout(콜백, 0)은 코드를 논블로킹으로 만들기 위해 사용하는 기법 중 하나입니다.
이벤트 루프를 이해했다면 setTimeout의 콜백 함수가 태스크 큐로 보내지므로 순서대로 실행되지 않는다는 것을 알 수 있습니다.

setTimeout(콜백, 0)
밀리초를 0으로 설정했으므로 바로 실행되는 것이 아닌가 착각할 수 있습니다.
하지만 브라우저와 노드에서는 기본적인 지연 시간이 있으므로 바로 실행되지 않습니다.
HTML5 브라우저에서는 4ms, 노드에서는 1ms의 지연 시간이 있습니다.

노드는 싱글 스레드이므로 주어진 작업을 혼자서 처리해야 합니다.
반대로 멀티 스레드인 시스템에서는 여러 개의 스레드가 일을 나눠서 처리할 수 있습니다.

자바스크립트와 노드에서 논블로킹이 중요한 이유는 바로 싱글 스레드이기 때문입니다.
한 번에 한 가지 일밖에 처리하지 못하므로 어떠한 작업에서 블로킹이 발생하면 다음 일을 처리하지 못합니다.

노드도 싱글 스레드 여러 개를 사용해 멀티 스레딩과 비슷한 기능을 하게 할 수 있습니다.
하지만 엄밀히 말하면 멀티 스레딩이라기보다는 멀티 프로세싱에 가깝습니다.

프로세스와 스레드의 차이

- 프로세스는 운영체제에서 할당하는 작업의 단위입니다. 노드나 인터넷 브라우저 같은 프로그램은 개별적인 프로세스입니다. 프로세스 간에는 메모리 등의 자원을 공유하지 않습니다.
- 스레드는 프로세스 내에서 실행되는 흐름의 단위입니다. 하나의 프로세스는 스레드를 여러 개 가질 수 있습니다. 스레드들은 부모 프로세스의 자원을 공유합니다. 즉, 같은 메모리에 접근할 수 있습니다.

사실 노드 프로세스도 내부적으로는 스레드를 여러 개 가지고 있습니다.
하지만 우리가 직접 제어할 수 잇는 스레드는 하나뿐이므로 흔히 싱글 스레드라고 부르는 것입니다.

노드는 스레드를 늘리는 대신, 프로세스 자체를 복사해 여러 작업을 동시에 처리하는 멀티 프로세싱 방식을 택했습니다.
자바스크립트 언어 자체가 싱글 스레드 특성을 띠고 있기 때문입니다.

## 1.2 서버로서의 노드

노드가 싱글 스레드, 논블로킹 모델을 사용하므로, 노드 서버 또한 동일한 모델일 수밖에 없습니다.
싱글 스레드여서 멀티 스레드 방식보다는 컴퓨터 자원을 적게 사용하는 장점이 있지만, CPU 코어를 하나밖에 사용하지 못하는 단점도 있습니다.

노드 서버는 I/O가 많은 작업에 적합합니다.
노드는 libuv 라이브러리를 사용하여 I/O 작업을 논블로킹 방식으로 처리해줍니다.
따라서 스레드 하나가 많은 수의 I/O를 혼자서도 감당할 수 있습니다.
하지만 CPU 부하가 큰 작업에는 적합하지 않습니다.

싱글 스레드 방식의 프로그래밍은 멀티 스레드 방식보다 상대적으로 쉽습니다.
하지만 싱글 스레드이다 보니 하나뿐인 스레드가 에러로 인해 멈추지 않도록 잘 관리해야 합니다.
에러를 제대로 처리하지 못하면 서버 전체가 멈추기 때문입니다.

또한, 웹 서버가 내장되어 있어 입문자가 쉽게 접근할 수 있습니다.

노드 사용자들이 말하는 가장 큰 장점은 언어로 자바스크립트를 사용한다는 것입니다.
웹 브라우저도 자바스크립트를 사용하므로 서버까지 노드를 사용하면 하나의 언어로 웹 사이트를 개발할 수 있습니다.
이는 개발 생산성을 획기적으로 높여주었고, 생산성으로 중요한 기업이 노드를 채택하는 이유가 되었습니다.

노드는 생산성은 매우 좋지만, Go처럼 비동기에 강점을 보이는 언어나 nginx처럼 정적 파일 제공, 로드 밸런싱에 특화된 서버에 비해서는 속도가 느립니다.

JSON이 자바스크립트 형식이어서 노드에서 쉽게 처리할 수 있습니다.

노드의 장점

- 멀티 스레드 방식에 비해 컴퓨터 자원을 적게 사용함
- I/O 작업이 많은 서버로 적합
- 멀티 스레드 방식보다 쉬움
- 웹 서버가 내장되어 있음
- 자바스크립트를 사용함
- JSON 형식과 호환하기 쉬움

노드의 다나점

- 싱글 스레드라서 CPU 코어를 하나만 사용함
- CPU 작업이 많은 서버로는 부적합
- 하나뿐인 스레드가 멈추지 않도록 관리해야 함
- 서버 규모가 커졌을 때 서버를 관리하기 어려움
- 어중간한 성능

## 1.3 서버 외의 노드

처음에는 대부분 노드를 서버로 사용하지만, 노드는 자바스크립트 런타임이기 때문에 용도가 서버에만 한정된 것은 아닙니다.
사용 범위가 점점 늘어나 웹, 모바일, 데스크톱 애플리케이션 개발에도 사용되기 시작했습니다.
