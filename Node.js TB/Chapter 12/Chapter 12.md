# Chapter 12. 실시간 경매 시스템 만들기

## 12.1 프로젝트 구조 갖추기

프로젝트는 새 모델, 즉 사용자 모델, 제품 모델, 경매 모델로 구성됩니다.

사용자 모델은 이메일(email), 닉네임(nick), 비밀번호(password), 보유 자금(money)으로 구성됩니다.

상품 모델을 상품명(name), 상품 사진(img), 시작 가격(price)으로 구성됩니다.

경메 모델은 입찰가(bid)와 입찰 시 메시지(msg)로 구성됩니다.
입찰 시 메시지는 null이어도 됩니다.

모델을 생성한 후에 모델을 데이터베이스 및 서버와 연결합니다.

sequelize db:create 명령어로 데이터베이스를 생성합니다.

사용자가 입찰을 여러 번 할 수 있으므로 사용자 모델과 경매 모델도 일대다 관계입니다.
한 상품에 여러 명이 입찰하므로 상품 모델과 경매 모델도 일대다 관계입니다.

사용자 모델과 상품 모델 간에는 일대다 관계가 두 번 적용됩니다.
사용자가 여러 상품을 등록할 수 있고, 사용자가 여러 상품을 낙찰받을 수도 있기 때문입니다.
두 관계를 구별하기 위해 as 속성에 owner, sold로 관계명을 적어주었습니다.
각각 ownerId, soldId 컬럼으로 상품 모델에 추가됩니다.

경매 시스템은 회원가입, 로그인, 경매상품 등록, 방 참여, 경매 진행으로 이루어져 있습니다.

상품을 업로드하는 페이지인 good.pug 파일에서는 이미지 업로드(#good-img)도 같이 해야 하므로 form 태그의 enctype이 multipart/form-data로, 폼데이터를 사용하도록 설정하였습니다.

router.use에서 res.locals.user = req.user;로 모든 pug 템플릿에 사용자 정보를 변수로 집어 넣었습니다.
이렇게 하면 res.render 메서드에 user: req.user를 하지 않아도 되므로 중복을 제거할 수 있습니다.

라우터는 GET /, GET /join, GET /good, POST /good으로 이루어져 있습니다.
GET /는 메인 화면을 렌더링합니다.
렌더링할 때 경매가 진행 중인 상품 목록도 같이 불러옵니다.
soldId가 낙찰자의 아이디이므로 낙찰자가 null이면 경매가 진행 중인 것입니다.
GET /join과 GET /good는 각각 회원가입 화면과 상품 등록 화면을 렌더링합니다.
POST /good 라우터는 업로드한 상품을 처리하는 라우터입니다.
상품 이미지 업로드 기능이 있어 multer 미들웨어가 붙었습니다.
