# Chapter 8. 몽고디비

몽고디비의 특징 중 하나는 자바스크립트 문법을 사용한다는 것입니다.

## 8.1 NoSQL vs SQL

MySQL은 SQL을 사용하는 대표적인 데이터베이스이며, SQL을 사용하지 않는, NoSQL(Not onl SQL)이라고 부르는 데이터베이스도 있습니다.

NoSQL에는 고정된 테이블이 없습니다.
테이블에 상응하는 컬렉션이라는 개념이 있긴 하지만, 컬럼을 따로 정의하지는 않습니다.

몽고디비에는 JOIN 기능이 없습니다.

트랜잭션을 지원하지 않는 것도 몽고디비의 특지 중 하나입니다.
트랜잭션이란 여러 쿼리가 모두 정상적으로 수행되거나 아예 하나도 수행죄디 않음을 보장하는 기능입니다.

몽고디비를 사용하는 잉는 확장성과 가용성 때문입니다.
데이터의 일관성을 보장해주는 기능이 약한 대신 데이터를 빠르게 넣을 수 있고, 쉽게 여러 서버에 데이터를 분산할 수 있습니다.
MySQL의 테이블, 로우, 컬럼을 몽고디비에서는 각각 컬렉션, 다큐먼트, 필드라고 부릅니다.

## 8.4 데이터베이스 및 컬렉션 생성하기

데이터베이스를 만드는 명령어는 use [데이터베이스명]입니다.

데이터베이스 목록을 확인하는 명령어는 show dbs입니다.

현재 사용 중인 데이터베이스를 확인하는 명령어는 db입니다.

## 8.5 CRUD 작업하기

### 8.5.1 Create(생성)

컬렉션에 컬럼을 정의하지 않아도 되므로 컬렉션에는 아무 데이터나 넣을 수 있습니다.

기본적으로 몽고디비는 자바스크립트 문법을 사용하므로 자바스크립트의 자료형을 따릅니다.

Date나 정규표현식 같은 자바스크립트 객체를 자료형으로 사용할 수 있고, Binary Data, ObjectId, Int, Long, Decimal, Timestamp, JavaScript 등의 추가적인 자료형이 있습니다.
Undefined와 Symbol은 몽고디비에서 자료형으로 사용하지 않습니다.
ObjectId는 고유한 값을 가지므로 다큐먼트를 조회할 때 사용할 수 있습니다.

db.컬렉션명.save(다큐먼트)로 다큐먼트를 생성할 수 있습니다.
자바스크립트 객체처럼 생성하면 됩니다.

### 8.5.2 Read(조회)

find({})는 컬렉션 내의 모든 다큐먼트를 조회하라는 뜻입니다.

조회 시 조건을 주려면 첫 번째 인자 객체에 기입하면 됩니다.

몽고디비는 자바스크립트 객체를 사용해서 명령어 쿼리를 생성해야 하므로 \$gt 같은 특수한 연산자가 사용됩니다.

몽고디비에서 OR 연산은 \$or를 사용합니다.

조회할 다큐먼트 개수를 설정할 수도 있습니다.
limit 메서드를 사용합니다.

다큐먼트 개수를 설정하면서 몇 개를 건너뛸지 설정할 수도 있습니다.
skip 메서드를 사용합니다.

### 8.5.3 Update(수정)

첫 번째 객체는 수정할 다큐먼트를 지정하는 객체고, 두 번째 객체는 수정할 내용을 입력하는 객체입니다.
$set이라는 연산자는 어떤 필드를 수정할지 정하는 연산자입니다.
일부 필드만 수정하고 싶을 때는 반드시 $set 연산자를 지정해주어야 합니다.

수정에 성공했다면 첫 번째 객체에 해당하는 다큐먼트 수와 수정된 다큐먼트 수가 나옵니다.

### 8.5.4 Delete(삭제)

삭제할 다큐먼트에 대한 정보가 담긴 객체를 첫 번째 인자로 제공하면 됩니다.
성공 시 삭제된 개수가 반환됩니다.

## 8.6 몽구스 사용하기

MySQL에 시퀄라이즈가 있다면 몽고디비에는 몽구스가 있습니다.

몽구스는 시퀄라이즈와 달리 ODM이라고 불립니다.

몽기디비 자체가 이미 자바스크립트인데도 굳이 자바스크립트 객체와 매핑하는 이유는 몽고디비에 없어서 불편한 기능들을 몽구스가 보완해주기 때문입니다.

스키마.
몽구스는 몽고디비에 데이터를 넣기 전 노드 서버 단에서 데이터를 한 번 필터링하는 역할을 해줍니다.

MySQL에 있는 JOIN 기능을 populate라는 메서드로 어느 정도 보완해줍니다.
따라서 관계가 있는 데이터를 쉽게 가져올 수 있습니다.

ES2015 프로미스 문법과 강력하고 가독성이 높은 쿼리 빌더를 지원하는 것도 장점입니다.

### 8.6.1 몽고디비 연결하기

몽고디비는 주소를 사용해 연결합니다.

### 8.6.2 스키마 정의하기

몽구스 모듈에서 Schema 생성자를 사용해 스키마를 만듭니다.

몽구스 스키마에서 특이한 점은 String, Number, Date, Buffer, Boolean, Mixed, ObjectId, Array를 값으로 가질 수 있다는 점입니다.

name 필드의 자료형은 String이고 필수이며 고유한 값이어야 합니다.
age 필드는 Number 자료형이고 필수이며, married 필드는 불 값 자료형이고 필수입니다.
comment 필드는 String 자료형입니다.
required나 default 등의 옵션이 필요하지 않다면 간단하게 자료형만 명시하면 됩니다.
createdAt 필드는 Date 자료형이고 기본값은 Date.now(데이터 생성 당시의 시간)입니다.

### 8.6.3 쿼리 수행하기

몽구스도 기본적으로 프로미스를 지원하므로 then과 catch를 사용해서 각각 조회 성공 시아 실패 시의 정보를 얻을 수 있습니다.
