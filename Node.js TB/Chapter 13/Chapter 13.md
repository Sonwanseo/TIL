# Chapter 13. 구글 API로 장소 검색 서비스 만들기

## 13.1 프로젝트 구조 갖추기

프런트엔드 측에서는 Google Maps API를 사용해 장소를 표시하고, 백엔드 측에서는 Google Places API를 사용해 장소를 검색합니다.
검색을 통해 위치를 파악하여 위치 데이터를 프런트엔드로 내려보내는 것이 주요 목표입니다.

이번 프로젝트에서는 검색했던 내역과 즐겨찾기에 추가한 장소를 데이터베이스에 저장할 것입니다.
딱히 관계형 데이터베이스가 필요하지 않으므로 NoSQL 데이터베이스인 몽고디비와 몽고디비 ODM인 몽구스를 사용할 것입니다.

즐겨찾기 스키마는 장소 아이디, 장소명, 좌표, 생성시간으로 구성되어 있습니다.
location 필드는 좌표를 지정하는 필드로, 경도와 위도 정보가 배열로 들어갑니다.
index가 2dsphere로 되어 있는데, 위치 정보를 저장하겠다는 의미입니다.

검색 내역 스키마는 검색어와 생성 시간 스키마로 구성되어 있습니다.

## 13.2 Google Places API 사용하기

Google Places API를 사용하면 구글 지도와 구글 플러스가 사용하는 장소 데이터베이스에서 데이터를 가져올 수 있습니다.

구글은 노드를 위한 API 모듈을 따로 제공합니다.

핵심 로직이 담긴 라우터는 세 개의 라우터로 이루어져 있습니다.
메인화면을 보여주는 라우터, 검색어 자동완성 라우터, 장소 검색 라우터로 구성됩니다.

구글 지도 클라이언트는 콜백 방식으로 동작하는데, 몽구스 프로미스와 같이 사용하기 위해 프로미스 패턴으로 바꾸어주었습니다.
이렇게 바꿀 수 있는 콜백들은 프로미스로 바꿔서 최종적으로 async/awit 문법을 사용하는 것이 깔끔합니다.

검색창에는 keyup 이벤트가 붙어 있으므로 검색어 입력 시 자동 완성 요청을 서버로 전달합니다.
결과로 받은 예상 검색어들을 화면에 표시하고 눌렀을 때 검색할 수 있도록 하였습니다.

검색폼에는 submit 이벤트가 붙어 있습니다.
검색어를 입력하지 않았다면 폼 요청을 하지 않습니다.
검색어를 입력한 경우에는 폼 요청 주소(this.action)를 노드 라우터에 맞게 설정한 후, 폼 요청을 전송합니다.
